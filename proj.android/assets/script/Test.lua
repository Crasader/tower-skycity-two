luaStr  = "I' m Himi"
 
luaStr2 = "are you ok!"

initDelay = "5"

viewHide = "0"

luaTable={age = "李雪峰",name="Himi",sex="男"}

bgMusics = "fightBg|towerOutBG|towerInBG|titleBg|villageBg"

effectMusics = "hit1|hit2|doorOpen|menuOpen|itemBagOpen|pickup_key|pickup_gem_1|pickup_gem_2|pickup_gem_3|use_drug|towerShake|uplevel|towerShake2|nextChat|shield|sword|special"

goodsNum = "5"
good1="typeId:2003011|num:1|price:2|lock:0"
good2="typeId:2002017|num:2|price:2|lock:0"
good3="typeId:2002010|num:1|price:2|lock:1"
good4="typeId:2002011|num:1|price:4|lock:1"
good5="typeId:2002012|num:1|price:10|lock:1"

sharesNum = "3"
shareReward1 = "typeId:2002002|num:2###typeId:2003011|num:1"
shareReward2 = "typeId:2002002|num:2###typeId:2003011|num:1"
shareReward3 = "typeId:2002002|num:2###typeId:2003011|num:1"

musics = {
fightBg="musics/BGM9",
towerOutBG="musics/BGM10",
towerInBG="musics/BGM4",
titleBg="musics/BGM3",
villageBg="musics/BGM6",
hit1="musics/Weapon_Sword_Critical",
hit2="musics/Weapon_Shout_Man_1",
doorOpen="musics/doorOpen",
menuOpen="musics/menuOpen",
itemBagOpen="musics/UI_Item_Bag",
pickup_key="musics/Pickup_Coins04",
pickup_gem_1="musics/Pickup_GemBells02",
pickup_gem_2="musics/Pickup_GemBells03",
pickup_gem_3="musics/Pickup_GemBells13",
use_drug="musics/UI_Health",
towerShake="musics/towerShake",
towerShake2="musics/towerShake2",
uplevel="musics/UI_QuestComplete",
nextChat="musics/chatChange",
shield="musics/UI_Ground_sword_broken",
sword="musics/Common_Buckler_Defense",
special="musics/UI_Skill"
}

fightNew = {roundDelay = "0.3"}
fight = {fightDelay = "0.3", fightTotal = "6"}
xixue = {rate="0.34",absorb="0"}
jinghua = {rate="3"}
zuji = {rate="3"}
fightSpecial = {specialRate="{}",goodRate="{}",extendRate="{}",ringPerRadius=""}

digRate = {locate="0.30",hoe="0.70"}
treasures = {normals="",goods="treasure_0002",rares="treasure_0003",fixs="treasure_00001|treasure_00001|treasure_00002|treasure_00003|treasure_00004|treasure_00005|treasure_00006|treasure_00007|treasure_00008"}

trialType1 = {name = "魔塔基本", intro="基本魔塔玩法"}
trialType2 = {name = "敏捷测试", intro="考验操作性"}
trialType3 = {name = "迷宫测试", intro="犯迷糊"}

endText1 = {
title="Bad End",
content="有太多遗憾\n\n可惜却只能含恨而终"
}
endText2 = {
title="Good End",
content="这是你希望的结局吗？\n\n不过这确实证明了你的实力。\n是时候去挑战魔王试试了。"
}
endText3 = {
title="Perfect End",
content="完美的结局，你拯救了这座塔。\n\n但一切才刚刚开始。"
}

diaryText = {
task_1="type:Text---text:还有一个盾牌在|color:{0,0,0}###type:Text---text:8层|color:{255,0,0}###type:Text---text:，拿到它后会让你实力大增。|color:{0,0,0}",
task_2="type:Text---text:到9层拿晶核碎片|color:{0,0,0}",
task_3="type:Text---text:去|color:{0,0,0}###type:Text---text:3层|color:{255,0,0}###type:Text---text:，安置好碎片|color:{0,0,0}",
task_4="type:Text---text:另外两块碎片分别在12层和15层|color:{0,0,0}",
task_5="type:Text---text:做好准备，迎来最后决战|color:{0,0,0}",
tip_1="升级是有能力加成的，一般升一级会提高100血量，1点攻击力和1点防御力。一般怪物只有1点经验值，BOSS会有多点经验值。每30点经验升一级。",
tip_2="前期提高防御会是个不错的选择。",
tip_3="为什么有时提高攻击力不会降低受到伤害量？是因为没有减少攻击次数。",
tip_4="跟商人兑换钥匙会是个不错的选择。",
tip_5="金币攒够了，要及时去4层的商人那加点，虽然每次购买价格都会提高很多。但也是没办法的事，奸商当道啊。",
}

paperText = 
{
text1="8月21日\n真是不可思议，塔的下层居然有这么大的空间,这里好像跟塔的一层相连。这是！！里面有好多。。死人！？不，好像是没有灵魂的人，还有呼吸。\n那个巨大的焚烧炉难道是！！里面隐约可以看到人的尸骨。这是怎么回事？今晚姑且就藏在这里看看情况。\n\n8月22日\n有人进来了，看那模样，居然是天城国国王，他身后的警卫又搬来了几具没有灵魂的人类空壳。有几个被扔到炉里去了……好恐怖的\n惨叫声。可恶的天城人，人前表现的这么圣洁，背地里却干这种勾当！我要揭发他们这群恶魔！！\n\n8月25日\n还好没有将塔下发现的事跟亚当斯说。亚当斯被魔王控制住了，这件事传出去一定会天下大乱！我还是在这里再呆一阵子吧。\n\n8月26日\n今天传来了亚当斯被害的消息。可恶，魔王跟天城国王都是恶魔，人类注定是被欺凌奴役的对象！！\n\n",
text1Title="卡德加的日记本（下）",

text2="亲爱的贝拉：\n\n我不幸被魔王抓住了，魔王知道了我们的关系。并想利用这一点实施他的计划。我没有办法跟外界进行联系，还好怪盗卡德加帮助了我。得知你在塔内并无大碍后我也安心了许多。\n贝拉，我们之间已经掺杂了太多纠葛，已经回不到以前那些美好的日子了，再这样下去，将会殃及更多的人。听魔王说圣塔有清除记忆的上古力量，贝拉，为了你以后的幸福，请你接受圣塔的治疗，忘掉这一切，重新变回那个单纯快乐的贝拉吧。不用为我担心，我一定能逃出去。放心，我不会忘掉自己的誓言，我会永远在你身边保护你，不管你是否还记得我。\n\n亚当斯\n8月23日\n",
text2Title="亚当斯的书信",

text3="塔内突然发生剧烈颤动，振动大约持续了1一个小时，有3人被下落石砖砸伤，一人不幸身亡。\n大约傍晚9点，塔内出现了一只外貌恐怖的魔物。将其击毙后，我们对其进行调查，发现此魔物身上有人类残留的衣服。\n我们推断是否是塔底的人类尸体所变。但是此时已是午夜，经商议后决定第二天到塔底探查。\n\n塔底调查结果：人类尸体全部消失！但并未见到魔物。除此之外，周围并无异样。同样是傍晚，发现一只体型巨大的魔物，我的分队进行了艰苦的战斗，有一人被不幸杀害。其他人受重伤。公主在塔顶，并无大碍。但是公主的性情大变，情绪波动异常。\n\n获得了驻扎在塔附近的部队支援。其中有人类队员混入，进入塔内，便立刻精神萎靡，半日后便不醒人世，但尚有呼吸。同样是傍晚时分，发生了惊人的一幕，该人类突然醒过来，并且十分凶暴，我们将其制止后，发现他的身体在逐渐发生变化。变化过程肉眼可见，大约10分钟左右，其已经彻底变化成一只魔物。我们只能将其击毙。\n\n我们每晚都会遭遇魔物的袭击，而且魔物的数量也在增加，塔内只剩下我带领的皇家守卫部队，人数不足10人。我们挡住了通向上层的道路，以防魔物伤害公主。陛下为什么不派军队来拯救公主，她可以您的亲生女儿啊。",
text3Title="卫兵的报告书",

text4="光荡涤污垢，光明廓清黑暗。\n\n\n\n\n",
text4Title="",

text5="日光穿透污云浊气，自己却一尘不染。\n\n\n\n\n",
text5Title="",

text6="那些坐在黑暗中死荫里的人，被困苦和铁链捆锁。\n\n\n\n\n",
text6Title="",

text7="他从黑暗中，和死荫里，领他们出来，折断他们的绑索。\n\n\n\n\n",
text7Title="",

text8="8月7日\n可怜的贝拉公主被关进了圣塔里。亚当斯果然还是放心不下公主啊，拜托我到这里观察公主的情况。\n好不容易找到圣塔了，这里的门卫怎么会这么多。。看来得想起办法进去。这点问题是不会难倒我天下第一怪盗的。\n\n8月10日\n没想到塔的地基有这么深，不过还是让我找到突破口了，井口跟里面是相通的！\n\n8月20日\n几天都没有见到阳光了，地道终于挖成了！塔里应该有很多宝贝吧。。啊，要调查公主情况才行。",
text8Title="卡德加的日记本（上）",

text9="建于金耀星历248年2月9日\n\n？？？？（看不清）\n\n\n\n\n",
text9Title="",
}

swap1_num = "8"

swap1_0={title = "本店概不赊账", preCondition="", content = "gold:-20$$$hp:+100~~~none$$$none###gold:-20$$$str:+2~~~none$$$none###gold:-20$$$def:+4~~~none$$$none"}
swap1_1={title = "本店概不赊账", preCondition="", content = "gold:-60$$$hp:+200~~~none$$$none###gold:-60$$$str:+2~~~none$$$none###gold:-60$$$def:+4~~~none$$$none"}
swap1_2={title = "本店概不赊账", preCondition="", content = "gold:-120$$$hp:+300~~~none$$$none###gold:-120$$$str:+2~~~none$$$none###gold:-120$$$def:+4~~~none$$$none"}
swap1_3={title = "本店概不赊账", preCondition="", content = "gold:-180$$$hp:+400~~~none$$$none###gold:-180$$$str:+4~~~none$$$none###gold:-180$$$def:+2~~~none$$$none"}
swap1_4={title = "本店概不赊账", preCondition="", content = "gold:-270$$$hp:+500~~~none$$$none###gold:-270$$$str:+4~~~none$$$none###gold:-270$$$def:+2~~~none$$$none"}
swap1_5={title = "本店概不赊账", preCondition="", content = "gold:-360$$$hp:+700~~~none$$$none###gold:-360$$$str:+3~~~none$$$none###gold:-360$$$def:+3~~~none$$$none"}
swap1_6={title = "这座塔快要结束了吧，我适当降降价吧，下次还来我白送！", preCondition="", content = "gold:-300$$$hp:+800~~~none$$$none###gold:-300$$$str:+3~~~none$$$none###gold:-300$$$def:+3~~~none$$$none"}
swap1_7={title = "靠你了，救世主。这次算我白送你", preCondition="", content = "gold:-100$$$hp:+800~~~none$$$none###gold:-100$$$str:+3~~~none$$$none###gold:-100$$$def:+3~~~none$$$none"}



swap2_0={title = "修炼场需要经验值", preCondition="level:100", content = "xp:-30$$$level:+1~~~none$$$none###xp:-30$$$str:+2~~~none$$$none###xp:-30$$$def:+2~~~none$$$none"}

swap3_0={title = "本店概不赊账", preCondition="", content = "gold:-80$$$hp:+1000~~~none$$$none###gold:-38$$$str:+2~~~none$$$none###gold:-38$$$def:+2~~~none$$$none"}

swap4_0={title = "修炼场需要经验值", preCondition="level:30", content = "xp:-70$$$level:+1~~~none$$$none###xp:-35$$$str:+1~~~none$$$none###xp:-35$$$def:+1~~~none$$$none"}

swap5_0={title = "本店概不赊账", preCondition="", content = "gold:-110$$$hp:+2000~~~none$$$none###gold:-56$$$str:+3~~~none$$$none###gold:-56$$$def:+3~~~none$$$none"}

swap6_0={title = "修炼场需要经验值", preCondition="level:40", content = "xp:-100$$$level:+1~~~none$$$none###xp:-50$$$str:+1~~~none$$$none###xp:-50$$$def:+1~~~none$$$none"}

swap12_0={title = "本店大量收购晶石碎片", preCondition="", content = "sparPatch:-1$$$gold:+100~~~none$$$none"}

swap13_0={title = "本店大量收购钥匙", preCondition="", content = "key2:-1$$$gold:+50~~~none$$$none###key1:-1$$$gold:+100~~~none$$$none###key3:-1$$$gold:+200~~~none$$$none"}

swap14_0={title = "给我80金币，我就给你3把黄钥匙", preCondition="", content = "gold:-80$$$key2:+3~~~none$$$none"}

swap15_0={title = "给我90金币，我就给你1把蓝钥匙", preCondition="", content = "gold:-90$$$key1:+1~~~none$$$none"}

swap16_0={title = "给我220金币，我就给你3把黄钥匙", preCondition="", content = "gold:-220$$$key2:+3~~~none$$$none"}

swap17_0={title = "给我210金币，我就给你1把蓝钥匙", preCondition="", content = "gold:-210$$$key1:+1~~~none$$$none"}

swap18_0={title = "给我3把黄钥匙，我就给你1把蓝钥匙", preCondition="", content = "key2:-3$$$key1:1~~~none$$$none"}

swap19_0={title = "给我1把蓝钥匙，我就给你3把黄钥匙", preCondition="", content = "key1:-1$$$key2:3~~~none$$$none"}

swap20_0={title = "去四周找些晶石碎片,然后选择一种准备合成的晶石", justClose = "1", preCondition="", content = "sparPatch:-2$$$KBspar:+1~~~none$$$none###sparPatch:-2$$$RDspar:+1~~~none$$$none"}

swap21_0={title = "给我100金币，我就给你让路，别说我是路霸。我也不想这样。要怪就怪。。。", justClose = "1", preCondition="", content = "gold:-100$$$none~~~none$$$none"}

swap22_0={title = "给我50金币，我可以给你一个灵魂石", justClose = "1", preCondition="", content = "gold:-50$$$sparPatch:+1~~~none$$$none"}

playerDebug = {hp = "0", str = "0", def = "0", xp = "30", gold = "0", key1 = "0", key2 = "3", key3 = "0"}

function initCondition(condition)
end

function init()
    SEND("target:detect|type:addCellToWaitingRoom~~~name:player|typeId:1001001")
    SEND("target:detect|type:addCellToWaitingRoom~~~name:yila|typeId:1002002")
    SEND("target:detect|type:addCellToWaitingRoom~~~name:shenmi|typeId:1002001")
    SEND("target:detect|type:addCellToWaitingRoom~~~name:firstboss|typeId:1003016")
    SEND("target:detect|type:addCellToWaitingRoom~~~name:boss|typeId:1003016")
    SEND("target:detect|type:addCellToWaitingRoom~~~name:gongzhu|typeId:1002004")


    SEND("target:detect|type:setCurFloor~~~floorId:1|towerId:1")
    SEND("target:detect|type:addFromWaitingRoom~~~typeId:1001001|name:player|site:{5,0}")
    SEND("target:detect|type:setPlayer~~~name:player")


    COND("last_fight",0)
    COND("enterGame",1)
    COND("first_close_text1",1)
    COND("first_close_text2",1)
    COND("first_close_text8",1)
    COND("canConvey_switch_01010206",0)

    --藏宝库初始
    SEND("target:detect|type:cacheFloor~~~floorId:1|towerId:13")

    --SEND("target:detect|type:addAltar~~~towerId:4|floorId:3")

--    COND("floor1_plot1",1)
--    COND("floor1_plot1Enter", 1)
--    SEND("target:detect|type:setControlled~~~tag:3|value:0")


--    --速度
--    SEND("target:player|type:setSpeed~~~num:10")
--###############################################################################################################
    --初始传送
    SEND("target:player|type:convey~~~floorId:7|towerId:3|site:{6,0}")
--###############################################################################################################
--    --传送和手册
    SEND("target:player|type:addSpecialByType~~~typeId:2007003|num:1")
    SEND("target:player|type:addSpecialByType~~~typeId:2007004|num:1")

    --钥匙
    SEND("target:player|type:addPropByType~~~typeId:2002001|num:0")
    SEND("target:player|type:addPropByType~~~typeId:2002002|num:0")
    SEND("target:player|type:addPropByType~~~typeId:2002003|num:0")

    --灵魂石
    SEND("target:player|type:addPropByType~~~typeId:2002005|num:5")
--    --锤头
--    SEND("target:player|type:addPropByType~~~typeId:2002016|num:5")

--    --锄头
--    SEND("target:player|type:addPropByType~~~typeId:2002011|num:1")
--    --SEND("target:player|type:addPropByType~~~typeId:2002019|num:1")

    SEND("target:player|type:setHp~~~num:500")
    SEND("target:player|type:setStr~~~num:3")
    SEND("target:player|type:setDef~~~num:2")
    SEND("target:player|type:setGold~~~num:0")
    SEND("target:player|type:setXp~~~num:0")

    
    --SEND("target:detect|type:towerStartShake")
    
end

function endGame()
   --SEND("target:detect|type:stopBG") 
end

function plotUpdate(cond)
    --for k,v in pairs(cond) do
      --print("for:key:"..k.."   value:"..v)
    --end
    if cond["enterGame"] == 1 then
        COND("enterGame",0)
    end

    if cond["floor1_plot1"] == 1 then
        if cond["floor1_plot1Enter"] == 1 then
           COND("floor1_plot1Enter",0)

           SEND("target:detect|type:stopBG")

           DELY("target:player|type:guideTo~~~site:{5,4}",2.0)
           DELY("target:chatManager|type:set~~~id:1",3.0,"chatId_1_over_delay")

           
        end

        if cond["chatId_17_over"] == 1 then
           COND("chatId_17_over",0)
           DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"setControlled_1_delay")

           COND("floor1_plot1",0)
           COND("floor2_plot1",1)
           COND("floor2_plot1Enter",1)
        end
    end

    if cond["chatId_49_over"] == 1 then
        COND("chatId_49_over",0)
        SEND("target:detect|type:note~~~content:捡到一个小血瓶")
        SEND("target:player|type:addHp~~~num:50")
        SEND("target:detect|type:remove~~~name:Cell_01021011")
    end

    if cond["chatId_2077_over"] == 1 then
        COND("chatId_2077_over",0)
        SEND("target:detect|type:note~~~content:捡到一个小血瓶")
        SEND("target:player|type:addHp~~~num:50")
        SEND("target:detect|type:remove~~~name:Cell_01080512")
    end

    if cond["chatId_2685_over"] == 1 then
        COND("chatId_2685_over",0)
        SEND("target:detect|type:remove~~~name:Cell_01020001")
    end

    if cond["chatId_2697_over"] == 1 then
        COND("chatId_2697_over",0)
        SEND("target:detect|type:remove~~~name:Cell_01020804")
    end

    if cond["chatId_2705_over"] == 1 then
        COND("chatId_2705_over",0)
        SEND("target:detect|type:remove~~~name:Cell_01020900")
    end

    if cond["chatId_2717_over"] == 1 then
        COND("chatId_2717_over",0)
        SEND("target:detect|type:remove~~~name:Cell_01020902")
    end

    if cond["chatId_2725_over"] == 1 then
        COND("chatId_2725_over",0)
        SEND("target:detect|type:remove~~~name:Cell_01020906")
    end

    if cond["chatId_2737_over"] == 1 then
        COND("chatId_2737_over",0)
        SEND("target:detect|type:remove~~~name:Cell_01020909")
    end

    if cond["floor2_plot1"] == 1 then

        if cond["player_convey_2"] == 1 and cond["floor2_plot1Enter"] == 1 then
            COND("floor2_plot1Enter", 0)
            COND("player_convey_2", 0)
            SEND("target:chatManager|type:set~~~id:29")
        end

        if cond["switch_01020510_crashOn"] == 1 then
            COND("switch_01020510_crashOn",0)
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            SEND("target:player|type:stop")
            SEND("target:detect|type:remove~~~name:switch_01020510")
            DELY("target:chatManager|type:set~~~id:77",1.0,"setChat_77_delay")
            SEND("target:detect|type:addFromWaitingRoom~~~typeId:1002002|name:yila|site:{5,11}")
            SEND("target:detect|type:addEffect~~~typeId:3001001|site:{5,11}")
            DELY("target:detect|type:setControlled~~~tag:3|value:1",2.0,"setControlled_13_delay")
            DELY("target:player|type:face~~~toCell:yila",1.0,"")
        end

        if cond["chatId_137_over"] == 1 then
            COND("chatId_137_over",0)
            SEND("target:detect|type:addByType~~~typeId:2004001|site:{4,10}")
            SEND("target:detect|type:addByType~~~typeId:2004006|site:{6,10}")
            SEND("target:detect|type:addEffect~~~typeId:3001001|site:{4,10}")
            SEND("target:detect|type:addEffect~~~typeId:3001001|site:{6,10}")
            --解除玩家操作
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            DELY("target:chatManager|type:set~~~id:141",2,"chatId_141_over_delay")
        end

        if cond["chatId_157_over"] == 1 then
            COND("chatId_157_over",0)
            SEND("target:detect|type:removeToWaitingRoom~~~name:yila")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{5,11}")
            --启动玩家操作
            DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"setControlled_1_delay")

            COND("wait_add_2002007",1)
            COND("wait_add_2002008",1)
            COND("wait_add_2002009",1)

            COND("floor2_plot1",0)
            COND("floor3_plot1",1)
            COND("floor3_plot1Enter",1)
        end
    end

    if cond["floor3_plot1"] == 1 then
        if cond["player_convey_3"] == 1 and cond["floor3_plot1Enter"] == 1 then
            COND("floor3_plot1Enter", 0)
            SEND("target:detect|type:playBG~~~name:towerInBG|loop:1")

            SEND("target:detect|type:shareRewardOpen")

            
        end

        if cond["chatId_185_over"] == 1 then
            COND("chatId_185_over", 0)
            SEND("target:detect|type:remove~~~name:switch_01030204")
            SEND("target:detect|type:remove~~~name:switch_01030205")
            SEND("target:detect|type:remove~~~name:switch_01030206")
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
        end
        if cond["chatId_197_over"] == 1 then
            COND("chatId_197_over",0)
            SEND("target:detect|type:add~~~typeId:1003020|site:{5,5}|name:youling")
            --SEND("target:detect|type:addFromWaitingRoom~~~typeId:1002001|site:{5,5}|name:shenmi")
            SEND("target:detect|type:addEffect~~~typeId:3001001|site:{5,5}")
            DELY("target:chatManager|type:set~~~id:213",2.0,"setChat_213_delay")
        end

        if cond["chatId_225_over"] == 1 then
            COND("chatId_225_over",0)
            SEND("target:detect|type:disappear~~~name:youling")
            --SEND("target:detect|type:addEffect~~~typeId:3001001|site:{5,5}")
            DELY("target:detect|type:none",2.0,"delay_disappear")
        end

        if cond["delay_disappear"] == 1 then
            COND("delay_disappear",0)
            ADD_CELL_WITH_TRIGGER("key_01030505","2002002","crashOn$target:chatManager|type:set~~~id:253","site:{5,5}")
            SEND("target:chatManager|type:set~~~id:229")
        end

        if cond["chatId_237_over"] == 1 then
            COND("chatId_237_over",0)
            DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"setControlled_1_delay")

            SEND("target:detect|type:add~~~typeId:1003020|site:{6,3}|floorId:4|name:youling")

            COND("floor3_plot1",0)
            COND("floor4_plot1",1)
            COND("floor4_plot1Enter",1)
        end
    end

    if cond["switch_01030906_crashing"] == 1 then
        SEND("target:detect|type:remove~~~name:switch_01030906")
    end

    if cond["chatId_169_over"] == 1 then
        COND("chatId_169_over",0)
        SEND("target:detect|type:disappear~~~name:monster_01030901")
    end

    if cond["chatId_177_over"] == 1 then
        COND("chatId_177_over",0)
        SEND("target:detect|type:disappear~~~name:monster_01030101")
    end

    if cond["chatId_373_over"] == 1 then
        COND("chatId_373_over",0)
        SEND("target:detect|type:remove~~~name:switch_01040905")
    end

    if cond["chatId_389_over"] == 1 then
        COND("chatId_389_over",0)
        SET_CELL_MODEL("role_01041005","relation","2")
        SET_CELL_MODEL("role_01041005","swapId","1")
        SEND("target:player|type:touchOn|senderType:Role|senderName:role_01041005")
    end

    if cond["floor4_plot1"] == 1 then

        if cond["floor4_plot1Enter"] == 1 then
            COND("floor4_plot1Enter", 0)
            --SEND("target:player|type:convey~~~floorId:4|toCellTypeId:2005008")
        end

        --幽灵引诱
        if cond["switch_01040601_crashing"] == 1 then
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            SEND("target:player|type:stop")
            SEND("target:detect|type:remove~~~name:switch_01040601")
            
            SEND("target:youling|type:flyOff~~~duration:2|position:{20,140}")
            DELY("target:detect|type:disappear~~~name:youling",1,"")

            DELY("target:detect|type:none",1,"delay_disappear_123")
        end

        if cond["delay_disappear_123"] == 1 then
            COND("delay_disappear_123",0)
            DELY("target:chatManager|type:set~~~id:405",0.5,"")

            SEND("target:detect|type:setControlled~~~tag:3|value:1")

            COND("floor4_plot1",0)
            COND("floor5_plot1",1)
            COND("floor5_plot1Enter",1)
        end
    end


    if cond["floor5_plot1"] == 1 then

        if cond["player_convey_5"] == 1 and cond["floor5_plot1Enter"] == 1 then
            COND("player_convey_5", 0)
            COND("floor5_plot1Enter", 0)
            SEND("target:chatManager|type:set~~~id:433")
            SEND("target:detect|type:addFromWaitingRoom~~~name:dika|site:{6,5}")
            SEND("target:floor5|type:addShade~~~fShade:shade.png|fMask:sten.png|site:{6,5}")
            SEND("target:dika|type:setChatId~~~chatId:465")
        end

        if cond["chatId_513_over"] == 1 then
            COND("chatId_513_over",0)
            SEND("target:door_01050909|type:open")
        end

        --捡到日记本
        if cond["player_has_special_01051011"] == 1 then
            COND("player_has_special_01051011",0)
            --迪卡的对话更新
            --SEND("target:detect|type:addFromWaitingRoom~~~name:dika|site:{6,5}|floorId:5")
            SEND("target:dika|type:setChatId~~~chatId:525")
        end

        if cond["chatId_541_over"] == 1 then
            COND("chatId_541_over",0)
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            SEND("target:floor5|type:addShade~~~fShade:shade.png|fMask:sten.png|site:{9,4}")
            DELY("target:door_01050904|type:open",1.0,"door_01050904_open_delay")
            DELY("target:chatManager|type:set~~~id:545",2.0,"setChat_545_delay")
        end

        if cond["chatId_553_over"] == 1 then
            COND("chatId_553_over",0)
            SEND("target:player|type:addSpecialByType~~~typeId:2007004|num:1")
            DELY("target:chatManager|type:set~~~id:557",2.0,"setChat_673_delay")
        end

        if cond["chatId_565_over"] == 1 then
            COND("chatId_565_over",0)
            SEND("target:detect|type:disappear~~~name:dika")
            --SEND("target:detect|type:addEffect~~~typeId:3001001|site:{5,5}")
            DELY("target:detect|type:none",2.0,"delay_disappear_1")
        end

        if cond["delay_disappear_1"] == 1 then
            COND("delay_disappear_1",0)
            SEND("target:chatManager|type:set~~~id:569")
            DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"setControlled_1_delay")
            ADD_CELL_WITH_TRIGGER("switch_01050603","2005001","stepOn$target:chatManager|type:set~~~id:593","site:{6,3}")
        end
        
        if cond["chatId_601_over"] == 1 then
            COND("chatId_601_over",0)
            SEND("target:detect|type:remove~~~name:switch_01050603")

            COND("floor5_plot1",0)
            COND("floor6_plot1",1)
            COND("floor6_plot1Enter",1)
        end
    end

    if cond["floor6_plot1"] == 1 then
        if cond["floor6_plot1Enter"] == 1 then
            COND("floor6_plot1Enter", 0)
            --SEND("target:player|type:convey~~~floorId:6|toCellTypeId:2005008")
            COND("floor6_plot1",0)
            COND("floor7_plot1",1)
            COND("floor7_plot1Enter",1)
        end

        --if cond["player_convey_6"] == 1 then
        --    COND("player_convey_6", 0)
        --    SEND("target:detect|type:setControlled~~~tag:3|value:0")
        --    DELY("target:chatManager|type:set~~~id:593",2.0,"setChat_593_delay")
        --end

        --if cond["chatId_601_over"] == 1 then
        --    COND("chatId_601_over",0)
        --    SEND("target:detect|type:removeToWaitingRoom~~~name:yila")
        --    SEND("target:detect|type:addEffect~~~typeId:3001006|site:{4,11}")
        --    DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"setControlled_1_delay")
        --end
    end

    if cond["floor7_plot1"] == 1 then
        if cond["floor7_plot1Enter"] == 1 then
            COND("floor7_plot1Enter", 0)
            --SEND("target:player|type:convey~~~floorId:7|toCellTypeId:2005008")

            COND("floor7_plot1",0)
            COND("floor9_plot1",1)
            COND("floor9_plot1Enter",1)
        end
    end

    ----晶石盘
    --if cond["chatId_1261_over"] == 1 then
    --    COND("chatId_1261_over", 0)
    --    SEND("target:detect|type:setControlled~~~tag:3|value:0")
    --    SEND("target:player|type:addSpecialByType~~~typeId:2007001|num:1")
    --    DELY("target:chatManager|type:set~~~id:1265",2.0,"setChat_1265_delay")
    --end

    --if cond["chatId_1273_over"] == 1 then
    --    COND("chatId_1273_over", 0)
    --    SET_CELL_MODEL("shangfan","relation","2")
    --    SET_CELL_MODEL("shangfan","shopId","14")
    --    SEND("target:player|type:touchOn|senderType:Role|senderName:shangfan")
    --    COND("wait_add_spar", 1)
    --    DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"setControlled_1_delay")
    --end

    --if cond["wait_add_spar"] == 1 and cond["player_swap_ok"] == 1 then
    --    COND("wait_add_spar", 0)
    --    COND("player_swap_ok", 0)
    --    DELY("target:chatManager|type:set~~~id:1289",1.0,"setChat_1289_delay")
    --end

    if cond["floor9_plot1"] == 1 then
        if cond["floor9_plot1Enter"] == 1 then
            COND("floor9_plot1Enter", 0)
            --SEND("target:player|type:convey~~~floorId:9|toCellTypeId:2005008")
        end

        if cond["switch_01090503_crashOn"] == 1 then
            COND("switch_01090503_crashOn",0)
            SEND("target:chatManager|type:set~~~id:669")
        end

        if cond["switch_01090505_crashOn"] == 1 then
            COND("switch_01090505_crashOn",0)
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            SEND("target:player|type:stop")
            SEND("target:detect|type:remove~~~name:switch_01090503")
            SEND("target:detect|type:remove~~~name:switch_01090505")
            SEND("target:detect|type:remove~~~name:door_01090504")
            SEND("target:detect|type:add~~~typeId:2001001|name:door_01090504|site:{5,4}")
            DELY("target:chatManager|type:set~~~id:681",1.0,"setChat_681_delay")
        end

        if cond["chatId_693_over"] == 1 then
            COND("chatId_693_over",0)
            SEND("target:door_01090509|type:open")
            DELY("target:monster_01090508|type:guideTo~~~site:{5,10}",1,"")
            DELY("target:detect|type:none",2,"delay_1")
        end

        if cond["delay_1"] == 1 then
            COND("delay_1",0)
            SEND("target:door_01090509|type:close")
            DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"")
        end

        --小BOSS战斗打完所有怪物，开门
        if cond["monster_01090405_isDead"] == 1 and cond["monster_01090406_isDead"] == 1 and cond["monster_01090407_isDead"] == 1 and cond["monster_01090605_isDead"] == 1 and cond["monster_01090606_isDead"] == 1 and cond["monster_01090607_isDead"] == 1 then
            COND("monster_01090405_isDead",0)
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            DELY("target:monster_01090508|type:guideTo~~~site:{5,8}",1,"")
            SEND("target:door_01090509|type:open")
            DELY("target:detect|type:none",2,"delay_2")
        end

        if cond["delay_2"] == 1 then
            COND("delay_2",0)
            SEND("target:door_01090509|type:close")
            SEND("target:chatManager|type:set~~~id:705")
        end
        
        if cond["chatId_709_over"] == 1 then
            COND("chatId_709_over",0)
            DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"")
        end

        if cond["monster_01090508_dead"] == 1 then
            COND("monster_01090508_dead",0)
            SEND("target:detect|type:setControlled~~~tag:3|value:0")

            SEND("target:door_01090906|type:open")
            SEND("target:door_01090909|type:open")
            SEND("target:door_01090106|type:open")
            SEND("target:door_01090109|type:open")

            SEND("target:door_01090504|type:open")

            SEND("target:detect|type:addFromWaitingRoom~~~typeId:1002002|name:yila|site:{6,8}")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{6,8}")
            SEND("target:yila|type:setChatId~~~chatId:765")
        
            DELY("target:chatManager|type:set~~~id:745",1.0,"setChat_745_delay")

            SEND("target:monster_01070511|type:setChatId~~~chatId:1973")

            SEND("target:detect|type:share~~~confirmText:居然打败了BOSS，快去分享吧|shareText:我打败了《魔塔天城》的BOSS！！")
        end

        if cond["chatId_757_over"] == 1 then
            COND("chatId_757_over",0)
            SEND("target:detect|type:disappear~~~name:monster_01090508")
            DELY("target:detect|type:none",2.0,"justDelay_3")
        end

        if cond["justDelay_3"] == 1 then
            COND("justDelay_3",0)
            SEND("target:detect|type:add~~~typeId:2002007|name:prop_01090508|site:{5,8}")
            SEND("target:detect|type:addEffect~~~typeId:3001001|site:{5,8}")
            DELY("target:chatManager|type:set~~~id:765",1.0,"setChat_765_delay")
        end

        if cond["chatId_797_over"] == 1 then
            COND("chatId_797_over",0)
            SEND("target:detect|type:removeToWaitingRoom~~~name:yila")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{6,8}")
            DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"")

            COND("floor9_plot1",0)
            COND("floor12_plot1",1)
            COND("floor12_plot1Enter",1)
        end
    end

    if cond["chatId_1977_over"] == 1 then
        COND("chatId_1977_over",0)
        SEND("target:detect|type:disappear~~~name:monster_01070511")
    end

    if cond["floor12_plot1"] == 1 then
        if cond["floor12_plot1Enter"] == 1 then
            COND("floor12_plot1Enter", 0)
            --SEND("target:player|type:convey~~~floorId:9|toCellTypeId:2005008")
        end

        if cond["switch_01120106_crashOn"] == 1 then
            COND("switch_01120106_crashOn",0)
            SEND("target:player|type:stop")
            SEND("target:detect|type:addFromWaitingRoom~~~typeId:1003016|name:firstboss|site:{1,8}")
            SEND("target:detect|type:setCellModelByName~~~name:firstboss|modelName:noDead|value:1")
            SEND("target:detect|type:setCellModelByName~~~name:firstboss|modelName:relation|value:3")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{1,8}")

            SEND("target:firstboss|type:setHp~~~num:500")
            SEND("target:firstboss|type:setStr~~~num:72")
            SEND("target:firstboss|type:setDef~~~num:26")

            SEND("target:detect|type:remove~~~name:switch_01120106")
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            SEND("target:player|type:stop")
            DELY("target:chatManager|type:set~~~id:897",1,"")
        end

        if cond["chatId_925_over"] == 1 then
            COND("chatId_925_over",0)
            DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"setControlled_1_delay")
        end

        if cond["firstboss_dead"] == 1 then
            COND("firstboss_dead",0)
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            DELY("target:chatManager|type:set~~~id:937",1,"")
        end

        if cond["chatId_961_over"] == 1 then
            COND("chatId_961_over",0)
            SEND("target:detect|type:disappear~~~name:firstboss")
            DELY("target:chatManager|type:set~~~id:977",2,"")
        end

        if cond["chatId_993_over"] == 1 then
            COND("chatId_993_over",0)
            DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"setControlled_1_delay")

            COND("floor12_plot1",0)
            COND("floor15_plot1",1)
            COND("floor15_plot1Enter",1)
        end
    end

    --小BOSS战斗打完所有怪物，开门
    if cond["monster_01120007_isDead"] == 1 and cond["monster_01120207_isDead"] == 1 and cond["firstboss_isDead"] == 1 then
        COND("monster_01120007_isDead",0)
        SEND("target:door_01120109|type:open")
    end

    --密室8层打怪，开门
    if cond["monster_02080407_isDead"] == 1 and cond["monster_02080607_isDead"] == 1 and cond["monster_02080406_isDead"] == 1 and cond["monster_02080606_isDead"] == 1 then
        COND("monster_02080407_isDead",0)
        SEND("target:door_02080508|type:open")
    end

    if cond["floor15_plot1"] == 1 then
        if cond["floor15_plot1Enter"] == 1 then
            COND("floor15_plot1Enter", 0)
            --SEND("target:player|type:convey~~~floorId:9|toCellTypeId:2005008")
        end
        if cond["player_convey_15"] == 1 then
            COND("player_convey_15", 0)
            DELY("target:chatManager|type:set~~~id:1145",2,"")

            COND("floor15_plot1",0)
            COND("floor16_plot1",1)
            COND("floor16_plot1Enter",1)
        end
    end

    --小BOSS战斗打完所有怪物，开门
    if cond["monster_01150405_isDead"] == 1 and cond["monster_01150406_isDead"] == 1 and cond["monster_01150407_isDead"] == 1 and
    cond["monster_01150605_isDead"] == 1 and cond["monster_01150606_isDead"] == 1 and cond["monster_01150607_isDead"] == 1  then
        COND("monster_01150405_isDead",0)
        SEND("target:door_01150508|type:open")
    end

    --捡到灵魂石碎片1
    if cond["player_has_2002007_num"] == 1 and cond["wait_add_2002007"] == 1 then
        COND("wait_add_2002007",0)

        SEND("target:detect|type:note~~~content:获得晶核碎片")
        SEND("target:detect|type:add~~~typeId:2005001|name:switch_01030406|site:{4,6}|floorId:3")
        SEND("target:detect|type:add~~~typeId:2005001|name:switch_01030407|site:{4,7}|floorId:3")

        COND("suipian_1",1)
    end

    if cond["suipian_1"] == 1 then
        --踩机关1
        if cond["switch_01030406_crashOn"] == 1 and cond["player_has_2002007_num"] == 1 then
            COND("switch_01030406_crashOn",0)
            SEND("target:chatManager|type:set~~~id:809")
        end

        --放灵魂石碎片1
        if cond["switch_01030407_touchOn"] == 1 and cond["player_has_2002007_num"] == 1 then
            COND("switch_01030407_touchOn",0)
            SEND("target:player|type:useProp~~~typeId:2002007|num:1|inBag:1")

            SEND("target:detect|type:add~~~typeId:2002007|name:prop_01030407|site:{4,7}|floorId:3")
            --SEND("target:chatManager|type:set~~~id:785")
            COND("switch_01030407_ON",1)
            if cond["switch_01030507_ON"] == 1 and cond["switch_01030607_ON"] == 1 then
            else
            SEND("target:detect|type:addFromWaitingRoom~~~name:yila|site:{6,6}")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{6,6}")

            DELY("target:chatManager|type:set~~~id:813",1.5,"")
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            end
        end

        if cond["chatId_881_over"] == 1 then
            COND("chatId_881_over",0)
            SEND("target:detect|type:removeToWaitingRoom~~~name:yila")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{6,6}")
            SEND("target:door_01090509|type:open")
            SEND("target:detect|type:setControlled~~~tag:3|value:1")
            COND("suipian_1",0)
        end
    end

    --捡到灵魂石碎片2
    if cond["player_has_2002008_num"] == 1 and cond["wait_add_2002008"] == 1 then
        COND("wait_add_2002008",0)
        SEND("target:detect|type:note~~~content:获得晶核碎片")
        SEND("target:detect|type:add~~~typeId:2005001|name:switch_01030506|site:{5,6}|floorId:3")
        SEND("target:detect|type:add~~~typeId:2005001|name:switch_01030507|site:{5,7}|floorId:3")

        COND("suipian_2",1)
    end

    if cond["suipian_2"] == 1 then
        --踩机关2
        if cond["switch_01030506_crashOn"] == 1 and cond["player_has_2002008_num"] == 1 then
            COND("switch_01030506_crashOn",0)
            SEND("target:chatManager|type:set~~~id:1005")
        end

        --放灵魂石碎片2
        if cond["switch_01030507_touchOn"] == 1 and cond["player_has_2002008_num"] == 1 then
            COND("switch_01030507_touchOn",0)
            SEND("target:player|type:useProp~~~typeId:2002008|num:1|inBag:1")

            SEND("target:detect|type:add~~~typeId:2002008|name:prop_01030507|site:{5,7}|floorId:3")
            --SEND("target:chatManager|type:set~~~id:785")
            COND("switch_01030507_ON",1)

            SEND("target:door_01120511|type:open")

            if cond["switch_01030407_ON"] == 1 and cond["switch_01030607_ON"] == 1 then
            else
            SEND("target:detect|type:addFromWaitingRoom~~~name:yila|site:{5,5}")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{5,5}")
            SEND("target:chatManager|type:set~~~id:1013")
            end
        end

        if cond["chatId_1121_over"] == 1 then
            COND("chatId_1121_over",0)
            SEND("target:detect|type:removeToWaitingRoom~~~name:yila")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{5,5}")
            COND("suipian_2",0)
        end
    end

    --捡到灵魂石碎片3
    if cond["player_has_2002009_num"] == 1 and cond["wait_add_2002009"] == 1 then
        COND("wait_add_2002009",0)
        SEND("target:detect|type:add~~~typeId:2005001|name:switch_01030606|site:{6,6}|floorId:3")
        SEND("target:detect|type:add~~~typeId:2005001|name:switch_01030607|site:{6,7}|floorId:3")
        DELY("target:chatManager|type:set~~~id:1161",1.0,"")

        COND("suipian_3",1)
    end

    if cond["suipian_3"] == 1 then
        --踩机关3
        if cond["switch_01030606_crashOn"] == 1 and cond["player_has_2002009_num"] == 1 then
            COND("switch_01030606_crashOn",0)
            SEND("target:chatManager|type:set~~~id:1193")
        end

        --放灵魂石碎片3
        if cond["switch_01030607_touchOn"] == 1 and cond["player_has_2002009_num"] == 1 then
            COND("switch_01030607_touchOn",0)
            SEND("target:player|type:useProp~~~typeId:2002009|num:1|inBag:1")
            SEND("target:detect|type:add~~~typeId:2002009|name:prop_01030607|site:{6,7}|floorId:3")
            COND("switch_01030607_ON",1)
            if cond["switch_01030407_ON"] == 1 and cond["switch_01030507_ON"] == 1 then
            else
            --DELY("target:chatManager|type:set~~~id:969",1.0,"")
            end
            COND("suipian_3",0)
        end
    end
    
    
    --晶核融合
    if cond["switch_01030607_ON"] == 1 and cond["switch_01030407_ON"] == 1 and cond["switch_01030507_ON"] == 1 then
        COND("switch_01030607_ON",0)

        --SEND("target:detect|type:cacheFloor~~~floorId:16")
        SEND("target:detect|type:addFromWaitingRoom~~~name:yila|site:{5,6}")
        SEND("target:detect|type:addEffect~~~typeId:3001006|site:{5,6}")

        SEND("target:chatManager|type:set~~~id:1197")
        SEND("target:detect|type:setControlled~~~tag:3|value:0")

        COND("suipian_ronghe",1)
    end

    if cond["suipian_ronghe"] == 1 then
        if cond["chatId_1217_over"] == 1 then
            COND("chatId_1217_over",0)

            DELY("target:detect|type:none",2,"delay_gem_to")
        end

        if cond["delay_gem_to"] == 1 then
            COND("delay_gem_to",0)
            SEND("target:detect|type:addFromWaitingRoom~~~name:boss|site:{5,5}|floorId:3|towerId:1")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{5,5}")
            DELY("target:chatManager|type:set~~~id:1229",1.0,"")
        end

        if cond["chatId_1241_over"] == 1 then
            COND("chatId_1241_over",0)

            SEND("target:detect|type:removeToWaitingRoom~~~name:boss")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{5,5}")

            SEND("target:detect|type:remove~~~name:prop_01030407")
            SEND("target:detect|type:remove~~~name:prop_01030507")
            SEND("target:detect|type:remove~~~name:prop_01030607")

            DELY("target:chatManager|type:set~~~id:1253",1.0,"")
        end
    
        if cond["chatId_1333_over"] == 1 then
            COND("chatId_1333_over",0)
            SEND("target:detect|type:removeToWaitingRoom~~~name:yila")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{5,6}")

            SEND("target:door_01150510|type:open")
            DELY("target:detect|type:setControlled~~~tag:3|value:1",1.0,"setControlled_1_delay")
            COND("suipian_ronghe",0)
        end
    end

    if cond["floor16_plot1"] == 1 then
        if cond["floor16_plot1Enter"] == 1 then
            COND("floor16_plot1Enter", 0)
            --SEND("target:player|type:convey~~~floorId:16|toCellTypeId:2005008")
        end

        if cond["player_convey_16"] == 1 then
            COND("player_convey_16", 0)
            SEND("target:detect|type:addFromWaitingRoom~~~name:boss|site:{5,7}|floorId:16|towerId:1")
            --SEND("target:detect|type:addFromWaitingRoom~~~name:yaonv|site:{5,7}|floorId:16")
            --SEND("target:detect|type:addEffect~~~typeId:3001006|site:{5,7}|floorId:16")
        end

        --提醒
        if cond["switch_01160502_crashing"] == 1 then
            SEND("target:player|type:stop")
            SEND("target:detect|type:remove~~~name:switch_01160502")
            SEND("target:chatManager|type:set~~~id:1881")
        end

        --进入
        if cond["switch_01160504_crashing"] == 1 then
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            SEND("target:player|type:stop")
            SEND("target:detect|type:remove~~~name:switch_01160504")
            DELY("target:detect|type:none",0.5,"conveyDelay")
        end

        if cond["conveyDelay"] == 1 then
            COND("conveyDelay", 0)
            SEND("target:player|type:guideTo~~~site:{5,5}")
            DELY("target:detect|type:none",3,"guideDelay_1")
        end

        if cond["guideDelay_1"] == 1 then
            COND("guideDelay_1", 0)
            SEND("target:chatManager|type:set~~~id:1349")
        end

        if cond["chatId_1369_over"] == 1 then
            COND("chatId_1369_over",0)
            SEND("target:detect|type:setCellModelByName~~~name:player|modelName:noDead|value:1")

            if cond["player_has_2002018_num"] == 1 and cond["player_has_2002019_num"] == 1 then
                DELY("target:chatManager|type:set~~~id:1569",1)
                COND("floor16_plot1",0)
                COND("floor16_plot3",1)
                COND("floor16_plot3Enter",1)
            else
                DELY("target:chatManager|type:set~~~id:1541",1)
                COND("floor16_plot1",0)
                COND("floor16_plot2",1)
                COND("floor16_plot2Enter",1)
            end
        end
    end

    --剧情一
    if cond["floor16_plot2"] == 1 then
        if cond["floor16_plot2Enter"] == 1 then
            COND("floor16_plot2Enter", 0)
            --SEND("target:player|type:convey~~~floorId:16|toCellTypeId:2005008")
        end

        -- 支线 战斗
        if cond["chatId_1545_over"] == 1 then
            COND("chatId_1545_over",0)
            --战斗
            DELY("target:player|type:fight~~~with:boss",1)
            COND("last_fight",1)
        end

        --主角被打爆了
        if cond["player_dead"] == 1 then
            COND("player_dead",0)
            DELY("target:chatManager|type:set~~~id:1381",1)
        end
        
        if cond["chatId_1405_over"] == 1 then
            COND("chatId_1405_over",0)
            DELY("target:detect|type:setEnd~~~endId:1",1)
        end

        --妖女被打爆了
        if cond["boss_dead"] == 1 then
            COND("boss_dead",0)
            DELY("target:chatManager|type:set~~~id:1421",1)
        end

        if cond["chatId_1469_over"] == 1 then
            COND("chatId_1469_over",0)
            DELY("target:detect|type:setEnd~~~endId:2",1)
        end
    end

    --主角被打爆了
    if cond["player_dead"] == 1 and cond["last_fight"] == 0 then
        COND("player_dead",0)
        DELY("target:chatManager|type:set~~~id:1989",1)
    end
        
    if cond["chatId_1997_over"] == 1 then
        COND("chatId_1997_over",0)
        DELY("target:detect|type:setEnd~~~endId:1",1)
    end

    --剧情二
    if cond["floor16_plot3"] == 1 then
        if cond["floor16_plot2Enter"] == 1 then
            COND("floor16_plot2Enter", 0)
            --SEND("target:player|type:convey~~~floorId:16|toCellTypeId:2005008")
        end

        if cond["chatId_1649_over"] == 1 then
            COND("chatId_1649_over",0)

            SEND("target:detect|type:note~~~content:公主的魔力减弱！！")

            SEND("target:boss|type:addStr~~~num:-10")
            SEND("target:boss|type:addDef~~~num:-5")

            SET_CELL_MODEL("boss","relation","0")
            SET_CELL_MODEL("boss","noDead","1")

            DELY("target:chatManager|type:set~~~id:1653",2)
        end

        if cond["chatId_1661_over"] == 1 then
            COND("chatId_1661_over",0)

            COND("wait_has_type_2002009",1)
            DELY("target:detect|type:setControlled~~~tag:3|value:1",0.2,"")
        end

        if cond["wait_has_type_2002009"] == 1 and cond["player_has_2002009_num"] >= 1 then
            COND("wait_has_type_2002009",0)
            DELY("target:chatManager|type:set~~~id:1673",0.2)
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
        end
        -- 主线 战斗
        if cond["chatId_1685_over"] == 1 then
            COND("chatId_1685_over",0)
            --战斗
            DELY("target:player|type:fight~~~with:boss",1)
            COND("last_fight",1)
        end

         --主角被打爆了
        if cond["player_dead"] == 1 then
            COND("player_dead",0)
            DELY("target:chatManager|type:set~~~id:1381",1)
        end
        
        if cond["chatId_1405_over"] == 1 then
            COND("chatId_1405_over",0)
            DELY("target:detect|type:setEnd~~~endId:1",1)
        end

        --妖女被打爆了
        if cond["boss_dead"] == 1 then
            COND("boss_dead",0)
            DELY("target:chatManager|type:set~~~id:1701",1)
            SEND("target:detect|type:addFromWaitingRoom~~~name:yila|site:{6,7}|floorId:16")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{6,7}|floorId:16")
        end

        if cond["chatId_1709_begin"] == 1 then
            COND("chatId_1709_begin",0)
            SEND("target:detect|type:removeToWaitingRoom~~~name:boss")
            SEND("target:detect|type:addFromWaitingRoom~~~name:gongzhu|site:{5,7}|floorId:16")
            SEND("target:detect|type:addEffect~~~typeId:3001006|site:{5,7}|floorId:16")
        end

        if cond["chatId_1713_over"] == 1 then
            COND("chatId_1713_over",0)
            
            DELY("target:detect|type:towerStartShake###target:detect|type:playEffect~~~name:towerShake2|loop:1",0.5,"")
        end

        if cond["chatId_1761_over"] == 1 then
            COND("chatId_1761_over",0)
            DELY("target:detect|type:setControlled~~~tag:3|value:1",0.2,"")
            SEND("target:yila|type:setChatId~~~chatId:1765")
            --关闭传送
            COND("conveyClose",1)
            COND("backlook",1)
        end

        if cond["player_convey_15"] == 1 and cond["backlook"] == 1 then
            COND("backlook",0)
            SEND("target:detect|type:setCurFloor~~~floorId:16")
            DELY("target:chatManager|type:set~~~id:1773",1)
        end

        if cond["chatId_1801_over"] == 1 then
            COND("chatId_1801_over",0)
            DELY("target:detect|type:setCurFloor~~~floorId:15",1.0,"")
            DELY("target:chatManager|type:set~~~id:1809",2)
            COND("runrun",1)
        end

        if cond["player_convey_1"] == 1 and cond["runrun"] == 1 then
            COND("runrun",0)
            SEND("target:detect|type:setControlled~~~tag:3|value:0")
            SEND("target:detect|type:towerEndShake")
            SEND("target:detect|type:stopAllEffect")
            SEND("target:detect|type:stopWeather~~~floorId:1|towerId:1")
            DELY("target:player|type:guideTo~~~site:{5,8}",1.0,"")
            DELY("target:chatManager|type:set~~~id:1845",4)
        end

        if cond["chatId_1865_begin"] == 1 then
            COND("chatId_1865_begin",0)
            DELY("target:player|type:guideTo~~~site:{5,1}",1.0,"")
            DELY("target:detect|type:setEnd~~~endId:3",3)
        end
    end
    
    --跟商人聊天获得奖励
    if cond["chatId_2273_over"] == 1 then
        COND("chatId_2273_over",0)
        SEND("target:player|type:addGold~~~num:50")
    end


    --打开大箱子
    if cond["chatId_2673_over"] == 1 then
        COND("chatId_2673_over",0)
        SEND("target:player|type:addGold~~~num:100")
        SEND("target:detect|type:note~~~content:获得100金币！")
        SEND("target:detect|type:remove~~~name:switch_02080510")
    end

    if cond["floor7_plot1"] == 1 then
        if cond["floor7_plot1Enter"] == 1 then
            COND("floor7_plot1Enter", 0)
            --SEND("target:player|type:convey~~~floorId:7|toCellTypeId:2005008")
        end
    end

    --小BOSS战斗打完所有怪物，开门
    if cond["monster_01080007_dead"] == 1 and cond["monster_01080207_isDead"] == 1 then
        COND("monster_01080007_dead",0)
        SEND("target:door_01080108|type:open")
    end

    

    --小BOSS战斗打完所有怪物，开门
    if cond["monster_01130006_dead"] == 1 and cond["monster_01130206_isDead"] == 1 and cond["monster_01130105_isDead"] == 1 then
        COND("monster_01130006_dead",0)
        SEND("target:door_01130107|type:open")
    end

    if cond["door_01060703_touchOn"] == 1 and cond["door_01060703_isOpen"] == 0 then
        COND("door_01060703_touchOn",0)
        SEND("target:chatManager|type:set~~~id:569")
    end

    if cond["door_01060707_touchOn"] == 1 and cond["door_01060707_isOpen"] == 0 then
        COND("door_01060707_touchOn",0)
        SEND("target:chatManager|type:set~~~id:569")
    end

    --if cond["door_01060202_touchOn"] == 1 and cond["door_01060202_isOpen"] == 0 then
    --    COND("door_01060202_touchOn",0)
    --    SEND("target:chatManager|type:set~~~id:569")
    --end

    if cond["door_01060208_touchOn"] == 1 and cond["door_01060208_isOpen"] == 0 then
        COND("door_01060208_touchOn",0)
        SEND("target:chatManager|type:set~~~id:573")
    end

    if cond["switch_01061009_crashing"] == 1 then
        SEND("target:player|type:guideTo~~~site:{10,7}")
    end

    --锄头解锁
    if cond["chatId_1921_over"] == 1 then
        COND("chatId_1921_over",0)
        SEND("target:detect|type:note~~~content:商店中可以购买锄头道具，及时查看")
        COND("good3_unlock",1)
        COND("good4_unlock",1)
        COND("good5_unlock",1)
    end


--------####################################       卡德加日记      ####################################--------------------
    --打开日记本下
    if cond["first_close_text1"] == 1 and cond["close_text1"] == 1 then
        COND("close_text1",0)
        COND("first_close_text1",0)
        SEND("target:chatManager|type:set~~~id:2357")
        COND("canOpen_switch_01020112",1)

        COND("kadejia_plot",1)
    end

    if cond["kadejia_plot"] == 1 then
        if cond["switch_01020112_1_touchOn"] == 1 then
            COND("switch_01020112_1_touchOn",0)
            if cond["canOpen_switch_01020112"] == 1 then
                COND("canOpen_switch_01020112",0)
                SEND("target:chatManager|type:set~~~id:2429")
                SEND("target:detect|type:remove~~~name:switch_01020112_1")
            else
                
            end
        end

        --施法解开2层封印
        if cond["chatId_2437_over"] == 1 then
            COND("chatId_2437_over",0)
            DELY("target:switch_01020112_2|type:on",1,"")
            DELY("target:detect|type:addEffect~~~typeId:3001001|site:{1,12}",1,"")
            COND("wait_convey_4",1)
        end

        if cond["player_convey_4"] == 1 and cond["wait_convey_4"] == 1 then
            COND("wait_convey_4",0)
            DELY("target:chatManager|type:set~~~id:2457",0.5,"")
            COND("wait_convey_5",1)
        end

        if cond["player_convey_5"] == 1 and cond["wait_convey_5"] == 1 then
            COND("wait_convey_5",0)
            DELY("target:chatManager|type:set~~~id:2481",0.5,"")
        end

        if cond["switch_02050106_crashing"] == 1 then
            COND("switch_02050106_crashing",0)
            SEND("target:detect|type:remove~~~name:switch_02050106")
            SEND("target:chatManager|type:set~~~id:2489")
        end

        if cond["chatId_2505_over"] == 1 then
            COND("chatId_2505_over",0)
            SEND("target:player|type:addPropByType~~~typeId:2002021|num:1")
        end
    
        --打开日记本上
        if cond["first_close_text8"] == 1 and cond["close_text8"] == 1 then
            COND("close_text8",0)
            COND("first_close_text8",0)
            SEND("target:chatManager|type:set~~~id:2517")
            COND("canOpen_switch_01010206",1)
        end

        if cond["switch_01010206_touchOn"] == 1 then
            COND("switch_01010206_touchOn",0)
            if cond["canOpen_switch_01010206"] == 1 then
                COND("canOpen_switch_01010206",0)
                SEND("target:chatManager|type:set~~~id:2537")
                --添加书籍机关
                SEND("target:detect|type:add~~~typeId:2005001|name:switch_02070409|site:{4,9}|floorId:7|towerId:2")
            --施法
            elseif cond["canMake_switch_01010206"] == 1 then
                COND("canMake_switch_01010206",0)
                SEND("target:chatManager|type:set~~~id:2601")
            --传送
            elseif cond["canConvey_switch_01010206"] == 1 then
                SEND("target:player|type:convey~~~floorId:6|towerId:2|site:{3,8}")
            else
                SEND("target:chatManager|type:set~~~id:57")
            end
        end

        --伊拉水魔法层成功
        if cond["chatId_2609_begin"] == 1 then
            COND("chatId_2609_begin",0)
            COND("canConvey_switch_01010206",1)
            SEND("target:switch_01010206|type:on")
            COND("wait_convey_6",1)
        end

        --伊拉修炼
        if cond["switch_02070409_touchOn"] == 1 then
            COND("switch_02070409_touchOn",0)
            SEND("target:chatManager|type:set~~~id:2577")
            COND("canMake_switch_01010206",1)
            SEND("target:detect|type:remove~~~name:switch_02070409")
        end

        if cond["player_convey_6"] == 1 and cond["wait_convey_6"] == 1 then
            COND("wait_convey_6",0)
            DELY("target:chatManager|type:set~~~id:2617",0.5,"")
        end

        if cond["player_add_paperText2"] == 1 then
            COND("player_add_paperText2",0)
            SEND("target:chatManager|type:set~~~id:2633")
        end

        --打开亚当斯书信
        if cond["first_close_text2"] == 1 and cond["close_text2"] == 1 then
            COND("close_text2",0)
            COND("first_close_text2",0)
            SEND("target:chatManager|type:set~~~id:2645")
            COND("kadejia_plot",0)
        end
    else
        if cond["switch_01020112_1_touchOn"] == 1 then
            COND("switch_01020112_1_touchOn",0)
            SEND("target:chatManager|type:set~~~id:65")
        end

        if cond["switch_02070409_touchOn"] == 1 then
            COND("switch_02070409_touchOn",0)
        end

        if cond["switch_01010206_touchOn"] == 1 then
            COND("switch_01010206_touchOn",0)
            --传送
            if cond["canConvey_switch_01010206"] == 1 then
                SEND("target:player|type:convey~~~floorId:6|towerId:2|site:{3,8}")
            else
                SEND("target:chatManager|type:set~~~id:57")
            end
        end
    end
--------####################################       卡德加日记      ####################################--------------------

--------####################################       神圣剑获得      ####################################--------------------
    --获得石头
    if cond["chatId_2313_over"] == 1 then
        COND("chatId_2313_over",0)
        SEND("target:player|type:addPropByType~~~typeId:2002005|num:1")
        DELY("target:detect|type:note~~~content:获得新物品，请查看背包^color:{255,0,0}|delay:1.5",1,"")
        COND("shenshengjian_plot",1)
    end

    if cond["shenshengjian_plot"] == 1 then
        --塔外商人
        if cond["chatId_2321_over"] == 1 then
            COND("chatId_2321_over",0)
            SEND("target:actor_01010611|type:setChatId~~~chatId:2329")
        end

        --判断是否够了
        if cond["chatId_2329_over"] == 1 then
            COND("chatId_2329_over",0)
            if cond["player_has_2002005_num"] >= 7 then
                SEND("target:chatManager|type:set~~~id:2341")
            else
                SEND("target:chatManager|type:set~~~id:2333")
            end
        end

        --给宝剑
        if cond["chatId_2345_over"] == 1 then
            COND("chatId_2345_over",0)
            SEND("target:player|type:removePropByType~~~typeId:2002005|num:6")
            SEND("target:player|type:addEquipByType~~~typeId:2004004")

            SEND("target:detect|type:share~~~confirmText:获得了终极武器，快去分享吧|shareText:我在《魔塔天城》获得了终极武器。")
        end

        --消失
        if cond["chatId_2349_over"] == 1 then
            COND("chatId_2349_over",0)
            SEND("target:detect|type:disappear~~~name:actor_01010611")
            COND("shenshengjian_plot",0)
        end
    end
--------####################################       神圣剑获得      ####################################--------------------


--------####################################       分享      ####################################--------------------

if cond["chatId_1941_over"] == 1 then
    COND("chatId_1941_over",0)
    SEND("target:detect|type:share~~~confirmText:恭喜获得炸药，快去分享吧|shareText:我在《魔塔天城》获得了一个炸药！！")
end

if cond["chatId_2061_over"] == 1 then
    COND("chatId_2061_over",0)
    SEND("target:detect|type:share~~~confirmText:恭喜获得锤头，快去分享吧|shareText:我在《魔塔天城》获得了一个锤头！！")
end

if cond["chatId_1921_over"] == 1 then
    COND("chatId_1921_over",0)
    SEND("target:detect|type:share~~~confirmText:恭喜获得锄头，快去分享吧|shareText:我在《魔塔天城》获得了一个锄头！！")
end

--捡到武器，分享
if cond["player_has_equip_01050906"] == 1 then
    COND("player_has_equip_01050906",0)
    SEND("target:detect|type:share~~~confirmText:获得了把武器，快去分享吧|shareText:我在《魔塔天城》获得了一把武器！")
end

--捡到武器，分享
if cond["player_has_equip_01080411"] == 1 then
    COND("player_has_equip_01080411",0)
    SEND("target:detect|type:share~~~confirmText:获得了盾牌，快去分享吧|shareText:我在《魔塔天城》获得了一个盾牌！")
end

if cond["chatId_2673_over"] == 1 then
    COND("chatId_2673_over",0)
    SEND("target:detect|type:share~~~confirmText:恭喜获得宝藏，快去分享吧|shareText:我在《魔塔天城》获得宝藏，发大财了！")
end

if cond["chatId_2657_over"] == 1 then
    COND("chatId_2657_over",0)
    SEND("target:detect|type:share~~~confirmText:解开了惊世谜团，快去分享吧|shareText:我在《魔塔天城》解开了惊世谜团，成为剧情达人！")
end

--------####################################       分享      ####################################--------------------

end